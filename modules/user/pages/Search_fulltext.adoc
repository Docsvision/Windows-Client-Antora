= Полнотекстовый поиск

Для использования полнотекстового поиска, если эта возможность активирована администратором {dv}, в интерфейсе приложения имеется xref:Interface_search_area.adoc[Область поиска]. При вводе искомого текста в область поиска, система ищет среди проиндексированных карточек те, которые содержат введенный текст.

В _{wincl}е_ поиск может производиться в разных режимах:

* [.keyword .parmname]_в текущей папке_ (подсказка `Поиск в                             текущей папке...`) -- поиск будет выполнен только в той папке, в которой пользователь находится на момент выполнения поискового запроса:
** при переходе пользователя в _стандартную_ папку (или делегата на неё) и ввода запроса в строку поиска, полнотекстовый поиск будет выполняться только среди карточек, находящихся в этой папке, независимо от постраничного вывода;
** при переходе пользователя в _виртуальную_ папку сначала будет выполнен настроенный для нее поисковый запрос. Затем, после ввода искомого текста в строку поиска, полнотекстовый поиск будет выполняться только среди карточек, найденных ранее по запросу для папки;
* [.keyword .parmname]_включая подпапки_ (подсказка `Поиск в                             текущей папке с учетом подпапок...`) -- поиск будет выполнен в текущей папке и ее подпапках. Режим доступен, если у текущей папки (независимо от её типа) есть дочерние папки и среди них есть хотя бы одна _стандартная_ подпапка. Если все дочерние папки _виртуальные_, режим будет недоступен. Если в качестве дочерних смешанный набор _виртуальных_, _стандартных_ и _папок-делегатов_, при поиске будут учитываться только _стандартные_ папки и _делегаты_ на них. При переходе к папке, не попадающей под условия, режим будет изменен на [.keyword .parmname]_в текущей папке_;
* [.keyword .parmname]_искать в найденном_ (подсказка `Поиск по                             результатам предыдущего поискового запроса...`) -- поиск будет выполнен среди значений, которые были найдены в результате выполненного поискового запроса;
* [.keyword .parmname]_везде_ (подсказка `Поиск по всем данных                             {dv}...`) -- поиск среди всех карточек системы.

[NOTE]
====
[.note__title]#Важное замечание:# Результаты полнотекстового поиска в режимах "в текущей папке" и "включая подпапки" не отображаются, когда в свойствах папки, по которой выполняется поиск, снят флаг "Разрешить обновление при переходе в папку".
====

Область поиска выбирается пользователем из числа доступных вариантов в выпадающем списке области поиска. При изменении режима поиска текст запроса не очищается. По умолчанию используется режим [.keyword .parmname]_в текущей папке_. Для системных папок [.keyword]*Карточки*, [.keyword]*Конструкторы и справочники*, [.keyword]*Папки* и [.keyword]*Корзина* доступен единственный режим поиска [.keyword .parmname]_Везде_. Если при поиске был выбран другой режим, при переходе в системные папки он будет автоматически изменен на [.keyword .parmname]_Везде_, значение поисковой строки при этом очищено не будет.

Также полнотекстовый поиск может выполняться по значениям полей, выбранных из базовых справочников системы. В последнем случае при поиске учитывается первый уровень ссылок.

При выполнении поиска доступна функция автозаполнения поисковой строки. Настройка количества сохраняемых в приложении поисковых запросов настраивается администратором в справочнике _Системные настройки_ (раздел [.ph .menucascade]#[.ph .uicontrol]*{wincl}* > [.ph .uicontrol]*Настройки поиска*#, параметр [.keyword .parmname]_Количество сохраненных поисковых запросов_).

image::img/Search_fulltex_saved_requests.png[[.fig--title-label]##Рис. 1. ##Выбор сохраненного поискового запроса в строке поиска]

Для подтверждения предлагаемого варианта следует нажать клавишу со "стрелкой вниз" на клавиатуре. Сортировка вариантов в выпадающем списке ранее использованных фраз происходит по дате их последнего добавления (использования): недавние запросы отображаются первыми. Предложения основаны на популярных запросах, которые были произведены ранее текущим пользователем. Список вариантов будет индивидуальным для каждого пользователя.

Чтобы выбрать предпочтительный вариант полнотекстового поиска, выполните следующие действия:

. [.ph .cmd]#В области полнотекстового поиска нажмите на кнопку image:img/Buttons/check_two_little.png[image].#
+
Будет открыто окно [.keyword .wintitle]*Настройки полнотекстового поиска*.

image::img/Search_fulltex_settings.png[[.fig--title-label]##Рис. 2. ##Настройки полнотекстового поиска]
. [.ph .cmd]#В группе настроек [.keyword]*Область поиска* установите переключатель в положение, соответствующее предпочтительному варианту поиска:#
* [.keyword .parmname]_Искать в тексте карточек или связанных с ними файлов_ -- поиск будет производиться по совпадениям строк или в тексте карточек, или в тексте вложенных файлов. Также в результаты поиска попадут карточки, в которых строки будут найдены одновременно в карточках и файлах. Данный вариант настроен для использования по умолчанию;
* [.keyword .parmname]_Искать в тексте карточек_ -- поиск не будет производиться по связанным файлам, но будет производиться по ссылочным полям справочников;
* [.keyword .parmname]_Искать в тексте файлов_ -- поиск производится только по тексту связанных файлов;
* [.keyword .parmname]_Искать файлы по имени и размеру_ -- поиск производится только по атрибутам файлов, но не по их содержанию.     
. [.ph .cmd]#В группе настроек [.keyword]*Типы карточек* можно изменить значение системной настройки полнотекстового поиска, задающей ограничение на поиск карточек определенных типов/видов. #
+
[NOTE]
====
Ограничение на полнотекстовый поиск по типу/виду карточки задается администратором в справочнике _Системные настройки_ для всех пользователей приложения _{wincl}_. Если администратором настроен запрет на персональное изменение данной системной настройки, область [.keyword]*Типы карточек* в окне [.keyword .wintitle]*Настройки полнотекстового поиска* у пользователей будет не активна.
====

[[task_q3g_vjh_gn__type_limitation]]
[NOTE]
====
Настройки ограничений типов карточек в _РМА_ и _{wincl}_ независимы и не оказывают влияния друг на друга.
====

Настройте персональные ограничения по типам карточек, которые попадут в результаты полнотекстового поиска:
* [.keyword]*Искать среди карточек всех типов* -- полнотекстовый поиск будет выполняться среди всех карточек, без ограничений по типу. Данный способ поиска используется по умолчанию;
* [.keyword]*Искать среди типов карточек, указанных администратором * -- полнотекстовый поиск будет выполняться в соответствии с настройками, заданными администратором в справочнике _Системные настройки_;
* [.keyword]*Искать среди карточек указанных типов* -- полнотекстовый поиск будет выполняться только среди карточек определенных типов/видов. Доступные типы/виды карточек отображаются в поле, которое становится активным при выборе данной настройки. Данные настройки являются персональными, и не связаны с настройками, заданными администратором в справочнике _Системные настройки_. Для удаления персональных настроек и восстановления системных настроек нажмите [.ph .uicontrol]*Сброс*.
+
Изменения будут сохранены в профиль пользователя.

[#task_q3g_vjh_gn__type_limit_request .ph]#Если из _{wincl}а_ будет выполнен поисковый запрос, созданный и сохраненный в _РМА_, то ограничения, заданные в этом запросе, будут учитываться как в _РМА_, так и в _{wincl}е_ (независимо от настроек последнего).#

Для обычных, не сохраненных запросов, пользовательские настройки ограничений будут действовать только в том приложении, из которого выполняется поисковый запрос.

При выполнении полнотекстового поиска из диалога атрибутивного запроса, совмещенного с полнотекстовым, поиск будет выполняться только по типам карточек, которые указаны в настройках параметрического запроса (см. пункт "Установка ограничения поиска по типам карточек" руководства по настройке). Настройки из профиля пользователя и/или справочника _Системных настроек_ в этом случае не учитываются.
. [.ph .cmd]#Чтобы результаты полнотекстового поиска были отфильтрованы в зависимости от свойств файлов, приложенных к искомым карточкам, установите флаг [.ph .uicontrol]*Использовать параметры поиска файлов*. #
+
Будет активирована соответствующая группа настроек.
. [.ph .cmd]#В поле [.keyword]*Маска файла* определите маску файла (имя и расширение).#
. [.ph .cmd]#В поле [.keyword]*Дата изменения* выберите один из вариантов:#
* [.keyword .parmname]_Любая_;
* [.keyword .parmname]_Пользовательская_ -- позволяет указать диапазон дат. При выборе данного становятся активными поля для ввода исходной и конечной даты интервала.
. [.ph .cmd]#В поле [.keyword]*Размер файла* укажите размер файла, равный, меньший или больший заданному значению в килобайтах. #
. [.ph .cmd]#Нажмите на кнопку [.ph .uicontrol]*ОК*.#
+
Настройки полнотекстового поиска для каждого пользователя должны быть сохранены между сессиями _{wincl}_, при перезапуске приложения настройки будут сохранены. Результат полнотекстового поиска будет выводиться с учетом сделанных настроек.
. [.ph .cmd]#В _Области поиска_ нажмите кнопку в правой части поля и выберите предпочтительный режим поиска.#
+
Если последним использованным режимом был [.keyword .parmname]_искать в найденном_ или [.keyword .parmname]_включая подпапки_, при последующих запусках приложения _{wincl}_ будет установлен режим по умолчанию [.keyword .parmname]_в текущей папке_.
+
image::img/Main_search_area.png[[.fig--title-label]##Рис. 3. ##Выбор режима полнотекстового поиска]
. [.ph .cmd]#Введите искомый текст в _Область поиска_. #
. [.ph .cmd]#Нажмите кнопку image:img/Buttons/find_in_view.png[image].#
+
Для режимов [.keyword .parmname]_в текущей папке_, [.keyword .parmname]_включая подпапки_ и [.keyword .parmname]_искать в найденном_ результаты будут отображены в той же папке (независимо от её типа), откуда был запущен поиск. Для вывода результатов будет использоваться представление исходной папки. Для режима [.keyword .parmname]_везде_ результаты будут отображены в системной папке xref:Folder_search_results.html[[.keyword]*Результаты поиска*] c представлением [.keyword]*Дайджест*.

Для очистки запроса воспользуйтесь кнопкой image:img/Buttons/delete_red_x.png[image].

Обратите внимание, администратор {dv} может настроить полнотекстовый поиск с использованием одной из нескольких систем полнотекстового поиска. В зависимости от системы результаты поиска, а также требования к исходным данным могут отличаться. Например, при поиске с использованием системы Elasticsearch есть следующие особенности:

* может потребоваться ввод большего числа знаков в словах поисковой фразы;
* результаты поиска могут содержать записи, которые не полностью соответствуют поисковой фразе;
* в некоторых вариантах поисковой фразы Elasticsearch может не возвращать результаты.

Также от выбора системы полнотекстового поиска зависит возможность поиска по различным типам файлов:

* при использовании встроенной в Microsoft SQL Server системы поиска: PDF и файлы Microsoft Office;
* при использовании системы полнотекстового поиска "Elasticsearch": PDF, файлы Microsoft Office (DOCX, DOC, XLSX, XLS, PPTX, PPT, RTF), HTML и TXT.
